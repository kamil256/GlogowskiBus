@model GlogowskiBus.UI.Models.HomeBusPositionsViewModel

@{
    ViewBag.Title = "Index";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<div id="busStopsList" data-bind="visible: selectedTab() == tabs[0]">
    
    <div class="itemsList" data-bind="foreach: busStops.toArray()">
        <div data-bind="click: function() { $root.selectedBusStop($data); return true; }, css: { active: $root.selectedBusStop() == $data }">
            <div>
                <input data-bind="checked: $root.selectedBusStop() == $data, checkedValue: true" type="radio" />
            </div>
            <div>
                <p data-bind="text: 'PRZYSTANEK #ID'"></p>
                <p data-bind="text: 'Nazwa: ' + name"></p>
                <p data-bind="text: 'Pozycja: ' + latitude + ', ' + longitude"></p>
                <p data-bind="text: 'Linie: ' + $root.busLinesNumbersListForBusStop($data)"></p>
            </div>
        </div>
    </div>
    <button class="btn btn-default">DODAJ</button>
    <button class="btn btn-default">EDYTUJ</button>
    <button class="btn btn-default">USUŃ</button>
</div>

<div id="busLinesList" data-bind="visible: selectedTab() == tabs[1]">
    <button class="btn btn-default">Nowa linia</button>
    <div data-bind="foreach: busLines.toArray()">
        <p>
            LINIA <span data-bind="text: busNumber"></span>
            <button class="btn btn-xs btn-default">Edytuj</button>
            <button class="btn btn-xs btn-default">Usuń</button>
            <button class="btn btn-xs btn-default">Nowa trasa</button>
        </p>
        <div class="itemsList" data-bind="foreach: $data.routes.toArray()">
            <div data-bind="click: function() { $root.selectedRoute($data); return true; }, css: { active: $root.selectedRoute() == $data }">
                <div>
                    <input data-bind="checked: $root.selectedRoute() == $data, checkedValue: true" type="radio" />
                </div>
                <div>
                    <p>
                        TRASA
                        <button class="btn btn-xs btn-default">Edytuj</button>
                        <button class="btn btn-xs btn-default">Usuń</button>
                    </p>
                    <p data-bind="text: busStops.getFirst().name + ' - ' + busStops.getLast().name"></p>
                    <p data-bind="text: indexMark + ' - ' + details, visible: indexMark && details"></p>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
window.onload = function()
{
    markerIcons = new MarkerIcons();
    serverTime = new ServerTime(@Model.ServerTimeMilliseconds);

    administrationContext = new AdministrationContext(@Html.Raw(Json.Encode(@Model.BusStops)), @Html.Raw(Json.Encode(@Model.BusLines)));
    ko.applyBindings(administrationContext);

    //function sendAjaxRequest(url, method, data, onSuccess)
    //{
    //    //layoutViewModel.secondsToAutomaticLogOut(600);
    //    $.ajax(url,
    //    {
    //        type: method,
    //        data: data,
    //        success: function(response)
    //        {
    //            console.log(response);
    //            //if (response.Success)
    //            //    displayNewSuccessMessage(response.Success);
    //            //if (response.Fail)
    //            //    displayNewFailMessage(response.Fail);
    //            //onSuccess(response);
    //        },
    //        error: function(response)
    //        {
    //            console.log(response);
    //            //displayNewFailMessage("Problem with connection. Try again, and if the problem persists contact your system administrator.");
    //        }//,
    //        //beforeSend: showProgressIndicator,
    //        //complete: hideProgressIndicator
    //    });
    //}

    //sendAjaxRequest('/api/BusLine', 'POST', 
    //{
    //    Id: 1,
    //    BusNumber: "A",
    //    Routes:
    //    [
    //        {
    //            Id: 2,
    //            Details: 'det',
    //            IndexMark: 'i'
    //        }
    //    ]

    //});
}
</script>
